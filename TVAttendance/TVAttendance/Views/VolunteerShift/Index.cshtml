@model IEnumerable<TVAttendance.Models.Shift>

@{
    TVAttendance.Models.Volunteer volunteer = (TVAttendance.Models.Volunteer)ViewBag.Volunteer;
    <partial name="_VolunteerDetails" model="volunteer"/>
    ViewData["Title"] = "Index";
}

<h1>Shifts</h1>

@if (Model.Count() != 0)
{
    <form asp-action="Index" method="get">
        <input type="hidden" name ="VolunteerID" value="@volunteer.ID"/>

        <div class="form-horizontal">
            <div class="form-horizontal">
                <button class="btn @ViewData["Filtering"]" type="button" data-bs-toggle="collapse" id="filterToggle"
                data-bs-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter" title="Click to open or close filter options.">
                    Filter/Search @ViewData["numFilters"]
                </button>

                <div class="collapse" id="collapseFilter">
                    <div class="card card-body bg-light">
                        <div class="row">
                            <div class="col-lg-3">
                                <div class="form-group" title="Filter by event name.">
                                    <label class="control-label">Search Event Name:</label>
                                    @Html.TextBox("SearchString", null, new { @class = "form-control", @placeholder = "i. e. Webinars" })
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group" title="Filter by past or upcoming shifts.">
                                    <label class="control-label">Filter by Shifts:</label>
                                    @Html.DropDownList("ActiveStatus", new List<SelectListItem>
                                {
                                    new SelectListItem { Value = "true", Text = "Upcoming" },
                                    new SelectListItem { Value = "false", Text = "Past" }
                                },
                                htmlAttributes: new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">

                                <div class="form-group align-self-end">
                                    <input type="submit" name="actionButton" value="Filter" class="btn btn-outline-primary" title="Submit current filter options." />
                                    <a asp-controller="VolunteerShift" asp-action="Index" class="btn btn-outline-dark" title="Clear all filter options" asp-route-VolunteerID="@volunteer.ID">Clear</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th title="Event Name column.">
                        @Html.DisplayNameFor(model => model.Event.EventName)
                    </th>
                    <th class="d-none d-sm-table-cell" title="Shift Date column.  The Day the shift occurs">
                        @Html.DisplayNameFor(model => model.ShiftDate)
                    </th>
                    <th class="d-none d-md-table-cell" title="Shift Range column.  The hours of a given shift from start to end.">
                        @Html.DisplayNameFor(model => model.ShiftRange)
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Event.EventName)
                        </td>
                        <td class="d-none d-sm-table-cell">
                            @Html.DisplayFor(modelItem => item.ShiftDate)
                        </td>
                        <td class="d-none d-md-table-cell">
                            @Html.DisplayFor(modelItem => item.ShiftRange)
                        </td>
                        <td>
                            @{
                                bool upcoming = (bool)ViewData["Upcoming"];

                                if(upcoming)
                                {
                                    if (item.ShiftDate.ToDateTime(TimeOnly.MinValue).Date.CompareTo(DateTime.Now.Date.AddDays(-5)) >= 0)
                                    {
                                        <a class="btn btn-outline-primary" asp-action="Details" asp-route-id="@item.ID" title="Click to edit Shift.">Details</a>
                                        <a class="btn btn-outline-danger" asp-action="Delete" asp-route-id="@item.ID" title="Click to cancel Shift.">Cancel</a>
                                    }
                                    else{
                                        <a class="btn btn-outline-primary" asp-action="Edit" asp-route-id="@item.ID" title="Click to edit Shift.">Edit</a>
                                        <a class="btn btn-outline-primary" asp-action="Details" asp-route-id="@item.ID" title="Click to edit Shift.">Details</a>
                                        <a class="btn btn-outline-danger" asp-action="Delete" asp-route-id="@item.ID" title="Click to cancel Shift.">Cancel</a>
                                    }  
                                }
                                else{
                                    <a class="btn btn-outline-primary" asp-action="Details" asp-route-id="@item.ID" title="Click to edit Shift.">Details</a>
                                }
                            
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <partial name="_PagingNavBar" />
    </form>
}
else{
    <p>No Registered Events</p>
    <a class="btn btn-outline-primary" asp-controller="Event" asp-action="Index" title="Click to view the Events log.">Events</a>
}



