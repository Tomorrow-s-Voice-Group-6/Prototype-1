@using TVAttendance.Utilities
@model IEnumerable<TVAttendance.Models.Shift>

@{
    TVAttendance.Models.Volunteer volunteer = (TVAttendance.Models.Volunteer)ViewBag.Volunteer;
    <partial name="_VolunteerDetails" model="volunteer"/>
    ViewData["Title"] = "Index";
}

<h1>Shifts</h1>


<input type="hidden" name ="VolunteerID" value="@volunteer.ID"/>

@{
    var todayShift = Model.Where(s => s.ShiftDate.ToDateTime(TimeOnly.MaxValue).Date.CompareTo(DateTime.Now.Date) == 0);

    if (todayShift.Count() == 0)
    {
        <hr />
        <p>No Shifts Today</p>
    }
    else{
        <form asp-controller="VolunteerShift" asp-action="ClockIn">
            <table>
                <thead>
                    <tr>
                        <th title="Event Name column.">
                            @Html.DisplayNameFor(model => model.Event.EventName)
                        </th>
                        <th class="d-none d-sm-table-cell" title="Shift Date column.  The Day the shift occurs">
                            @Html.DisplayNameFor(model => model.ShiftDate)
                        </th>
                        <th class="d-none d-md-table-cell" title="Shift Range column.  The hours of a given shift from start to end.">
                            @Html.DisplayNameFor(model => model.ShiftRange)
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in todayShift)
                    {
                        <tr>
                            <td title="Event Name column.">
                                @Html.DisplayNameFor(model => model.Event.EventName)
                            </td>
                            <td class="d-none d-sm-table-cell" title="Shift Date column.  The Day the shift occurs">
                                @Html.DisplayNameFor(model => model.ShiftDate)
                            </td>
                            <td class="d-none d-md-table-cell" title="Shift Range column.  The hours of a given shift from start to end.">
                                @Html.DisplayNameFor(model => model.ShiftRange)
                            </td>
                            <td>
                                <a class="btn btn-outline-primary" asp-route-VolunteerID="@volunteer.ID" asp-route-id="@item.ID">Clock-In</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </form>
    }

    <form asp-controller="VolunteerShift" asp-action="Index">
    @{
        <input type="hidden" name="VolunteerID" value="@volunteer.ID" />
        <input type="hidden" name="sortDirection" value="@ViewData["sortDirection"]" />
        <input type="hidden" name="sortField" value="@ViewData["sortField"]" />
        <div class="form-horizontal">
            <button class="btn @ViewData["Filtering"]" type="button" data-bs-toggle="collapse" id="filterToggle"
                    data-bs-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter">
                Filter/Search @ViewData["numFilters"]
            </button>

            <div class="collapse @ViewData["ShowFilter"]" id="collapseFilter">
                <div class="card card-body bg-light">
                    <div class="row">
                        <div class="form-group col-md-3">
                            <label title="Filter by characters in a Events name" class="control-label">Search Event Name:</label>
                            @Html.TextBox("SearchEventName", null, new { @class = "form-control" })
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">From Date:</label>
                            @Html.TextBox("FromDate", null, new { @id = "date-older", @type = "date", @class = "form-control" })
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">To Date:</label>
                            @Html.TextBox("ToDate", null, new { @id = "date-newer", @type = "date", @class = "form-control" })
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                        </div>
                        <div class="form-group align-self-end">
                            <input type="submit" name="actionButton" value="Filter"
                                   class="btn btn-outline-primary" />
                            <a asp-action="Index" class="btn btn-outline-dark">Clear</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        PaginatedList<Event> events = ViewBag.Events;
        <partial name="_EventList" model="events" />
    }
    </form>
    
}

